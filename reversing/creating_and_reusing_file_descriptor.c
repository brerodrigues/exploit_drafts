#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <fcntl.h>

/*
https://man7.org/linux/man-pages/man2/dup2.2.html
https://www.mkssoftware.com/docs/man3/dup2.3.asp
https://linuxhint.com/dup2_system_call_c/
*/
 
int main(int argc, char *argv[]) {
  if (argc < 4) {
      printf("Usage: %s file_to_read number_for_file_descriptor execve_file\n", argv[0]);
      printf("Example: %s key 343 baby_rev7\n", argv[0]);
      exit(EXIT_FAILURE);
  }

  int input_fds = open(argv[1], O_RDONLY); // key
 
  //  The new file descriptor is set to remain open across exec() functions. 
  if (dup2(input_fds, atoi(argv[2])) < 0) { // 343
    printf("Unable to duplicate file descriptor.");
    exit(EXIT_FAILURE);
  }

  execve(argv[3], NULL, NULL); // baby7 will read from de 343 file descriptor
 
  return EXIT_SUCCESS;
}
