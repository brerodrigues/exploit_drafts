import glob
from pwn import *

"""
https://www.cs.virginia.edu/~evans/cs216/guides/x86.html

Subtract rdi from the top value on the stack.

We will now set the following in preparation for your code:
rdi = 0xe2f5
(stack) [0x7fffff1ffff8] = 0x37894ecb
"""

context.arch = "x86_64"
#context.log_level = "DEBUG"

# pwntools will change SYS_exit to the respective syscall
assembly = """
    sub [rsp], rdi
"""

shellcode = asm(assembly)
#print(disasm(shellcode))

p = process(['/challenge/embryoasm_level14'])
print(p.recv(timeout=2).decode())
p.send(shellcode)
print(p.interactive())