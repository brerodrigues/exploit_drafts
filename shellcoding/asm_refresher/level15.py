import glob
from pwn import *

"""
https://www.cs.virginia.edu/~evans/cs216/guides/x86.html

In this level we are going to explore the last in first out (LIFO) property of the stack.

Using only following instructions:
push, pop
Swap values in rdi and rsi.
i.e.
If to start rdi = 2 and rsi = 5
Then to end rdi = 5 and rsi = 2

We will now set the following in preparation for your code:
rdi = 0x153f411d
rsi = 0x223e2eec
"""

context.arch = "x86_64"
#context.log_level = "DEBUG"

# pwntools will change SYS_exit to the respective syscall
assembly = """
    push rdi
    push rsi
    pop rdi
    pop rsi
"""

shellcode = asm(assembly)
#print(disasm(shellcode))

p = process(['/challenge/embryoasm_level15'])
print(p.recv(timeout=2).decode())
p.send(shellcode)
print(p.interactive())